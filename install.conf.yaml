- defaults:
    link:
      create: true
      force: true
    shell:
      stdin: true

# Clear broken symlinks
- clean: [ '~' ]
- clean:
    ~/.config:
      recursive: true

# System-specific setup steps
- link:
    # SSH
    ~/.ssh/config: ssh/config

- shell:
  - # Setup SSH keys
    command: source ./ssh/setup_ssh.sh
    description: Setting up SSH keys

# Install Homebrew if necessary
- install-brew: true

# Tap Homebrew taps
- tap:
  - homebrew/cask-fonts

# Install Homebrew packages
- brew:
  - fish
  - starship
  - gpg
  - git
  - git-delta
  - pyenv
  - juliaup
  - typst

# Install Homebrew casks
- cask:
  - mactex-no-gui
  - alacritty
  - karabiner-elements
  - visual-studio-code
  - font-fira-code-nerd-font
  - google-drive
  - calibre
  - iina
  - maccy

# Post-installation steps
- shell:
  - # Setup Python (with pyenv)
    command: source ./pyenv/setup_python.sh
    description: Setting up Python with pyenv
  - # Setup Julia (with juliaup)
    command: source ./juliaup/setup_julia.sh
    description: Setting up Julia with juliaup
  - # Use fish as default shell
    command: chsh -s $(which fish)
    description: Making fish the default shell

# Symlink dotfiles
- link:
    # Fish
    ~/.config/fish/config.fish: fish/config.fish
    ~/.config/fish/functions: fish/functions
    ~/.config/fish/conf.d: fish/conf.d
    # Starship
    ~/.config/starship.toml: starship/starship.toml
    # Git
    ~/.gitconfig: git/.gitconfig
    ~/.gitconfig.local: git/.gitconfig.local
    ~/.gitignore_global: git/.gitignore_global
    # Alacritty
    ~/.config/alacritty/alacritty.toml: alacritty/alacritty.toml
    ~/.config/alacritty/themes: alacritty/themes
    # Karabiner-Elements
    ~/.config/karabiner/karabiner.json: karabiner/karabiner.json
